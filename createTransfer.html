<!DOCTYPE html>
<html lang="es">  
<head>    
    <title>Create Transfer</title>    
    <link href="https://paymentez.github.io/api-doc/images/favicon-d165b374.svg" rel="icon" type="image/svg">
    <meta charset="UTF-8">
    <meta name="title" content="Título de la WEB">
    <meta name="description" content="Descripción de la WEB">     

</head>  
<body> 
  
<link rel="stylesheet" type="text/css" href="style.css"> 
    <header>
           
    </header>
  </head>
  <body>
  <div class="wrapper">
    <div class="navbar">
    <ul>
        <li><a href="index.html">Introduction</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Checkout Options</a>
          <ul class="dropdown-menu">
            <li><a href="checkout.html">Checkout</a></li>
            <li><a href="checkoutV3.html">Checkout With Reference</a></li>
            <li><a href="initCheckout.html">Checkout + Init reference</a></li>
          </ul>
        </li> 
        <li><a href="cash.html">Cash</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Bank Transfer</a>
          <ul class="dropdown-menu">
            <li><a href="getBanks.html">Get Banks</a></li>
            <li><a href="createTransfer.html">Create Transfer</a></li>
            <li><a href="getStatus.html">Get Status</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">QR EMVCO</a>
          <ul class="dropdown-menu">
            <li><a href="generateQR.html">Generate QR</a></li>
            <li><a href="consultQR.html">Consult QR</a></li>
            <li><a href="updateQR.html">Update QR</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Wallets</a>
          <ul class="dropdown-menu">
            <li><a href="generateOrderWallet.html">Generate Order</a></li>
            <li><a href="verifyOrderWallet.html">Consult Order</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Cards</a>
          <ul class="dropdown-menu">
            <li><a href="addCard.html">Add a Card</a></li>
            <li><a href="getAllCards.html">Get all Cards</a></li>
            <li><a href="deleteCard.html">Delete a Card</a></li>
            <li><a href="initReference.html">Init a Reference</a></li>
            <li><a href="debitWithToken.html">Debit With Token</a></li>
            <li><a href="debitWithCredit.html">Debit With Credit</a></li>
            <li><a href="debitWithCredit3d.html">Debit With Credit 3DS</a></li>
            <li><a href="debitWithToken3d.html">Debit With Token 3DS</a></li> 
            <li><a href="authorize.html">Authorize</a></li>
            <li><a href="capture.html">Capture</a></li>
            <li><a href="verify.html">Verify</a></li>
            <li><a href="refund.html">Refund</a></li>
            <li><a href="void.html">Void</a></li>
            <li><a href="getTransactionInfo.html">Transaction Info</a></li>
          </ul>
        </li>
        <li><a href="linktopay.html">Link To Pay</a></li>

    </ul>
</div>
</div>
<div class="container">
<img class="image" src="https://cdn.paymentez.com/img/nv/nuvei_logo.png">
    <form>
      <label for="environment">Environment:</label>
       <select id="environment" >
          <option value="#">Select</option>
          <option value="https://noccapi.paymentez.com/order/">PROD</option>
          <option value="https://noccapi-stg.paymentez.com/order/">STG</option>
        </select>

      <input type="text" id="appcode" name="appcode" placeholder="AppCode" required>
      <input type="password" id="appkey" name="appkey" placeholder="AppKey" required>

      <input type="text" id="name" name="nombre" placeholder="Name" required>

      <input type="text" id="last_name" name="apellido" placeholder="Last Name" required>

      <input type="email" id="email" name="correo" placeholder="Email" required>

      <input type="number" id="amount" name="monto" min="0" step="0.01" placeholder="Amount" required>

       <select id="paymentez_userType" >
          <option value="#">User Type</option>
          <option value="N">Natural</option>
          <option value="J">Jurídica</option>
        </select>

        <select id="paymentez_userFisNumber" >
          <option value="#">Type Fiscal</option>
          <option value="CC">Cédula de ciudadanía</option>
          <option value="CE">Cédula de extranjería</option>
          <option value="NIT">Número de identificación tributario</option>
          <option value="TI">Tarjeta de identidad</option>
          <option value="PP">Pasaporte</option> 
        </select>

        <input type="text" id="fiscal" name="cedula" placeholder="Fiscal Number" required>

      <select class="js-example-basic-single" id="paymentez_bankCode" >
          <option value="#">Bank</option>
          <option value="1022">Banco Union Colombiano</option>
          <option value="1558">BAN100</option>
          <option value="1059">BANCAMIA S.A.</option>
          <option value="1040">BANCO AGRARIO</option>
          <option value="1052">BANCO AV VILLAS</option>
          <option value="1013">BANCO BBVA COLOMBIA S.A.</option>
          <option value="1032">BANCO CAJA SOCIAL</option>
          <option value="1066">BANCO COOPERATIVO COOPCENTRAL</option>
          <option value="1051">BANCO DAVIVIENDA</option>
          <option value="1001">BANCO DE BOGOTA</option>
          <option value="1023">BANCO DE OCCIDENTE</option>
          <option value="1062">BANCO FALABELLA</option>
          <option value="1063">BANCO FINANDINA S.A. BIC</option>
          <option value="1012">BANCO GNB SUDAMERIS</option>
          <option value="1006">BANCO ITAU</option>
          <option value="1060">BANCO PICHINCHA S.A.</option>
          <option value="1002">BANCO POPULAR</option>
          <option value="1065">BANCO SANTANDER COLOMBIA</option>
          <option value="1069">BANCO SERFINANZA</option>
          <option value="1303">BANCO UNION antes GIROS</option>
          <option value="1007">BANCOLOMBIA</option>
          <option value="1061">BANCOOMEVA S.A.</option>
          <option value="1283">CFA COOPERATIVA FINANCIERA</option>
          <option value="1009">CITIBANK</option>
          <option value="1370">COLTEFINANCIERA</option>
          <option value="1292">CONFIAR COOPERATIVA FINANCIERA</option>
          <option value="1291">COOFINEP COOPERATIVA FINANCIERA</option>
          <option value="1289">COTRAFA</option>
          <option value="1097">DALE</option>
          <option value="1551">DAVIPLATA</option>
          <option value="1637">IRIS</option>
          <option value="1070">LULO BANK</option>
          <option value="1801">MOVII S.A.</option>
          <option value="1507">NEQUI</option>
          <option value="1811">RAPPIPAY</option>
          <option value="1019">SCOTIABANK COLPATRIA</option>
        </select>

      <input type="button" value="Enviar" onclick="obtenerDatos()">
    </form>
    <div id="result" style="display:none"></div>
</div>
    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>  

<script type="text/javascript">
  function obtenerDatos(){

    fetch('https://pg-micros.paymentez.com/v1/unixtime/')
      .then(response => response.json())
      .then(data => {
    
    var environment = document.getElementById('environment').value;
    var appcode = document.getElementById('appcode').value;
    var appkey = document.getElementById('appkey').value;
    var name = document.getElementById('name').value;
    var last_name = document.getElementById('last_name').value;
    var email = document.getElementById('email').value;
    var amount = document.getElementById('amount').value;
    var fiscal = document.getElementById('fiscal').value;
    var paymentez_bankCode = document.getElementById('paymentez_bankCode').value;
    var paymentez_userType = document.getElementById('paymentez_userType').value;
    var paymentez_userFisNumber = document.getElementById('paymentez_userFisNumber').value;

    if (!name || !last_name || !email || !amount || !fiscal ||!appcode ||!appkey) {
      alert("Por favor ingrese todos los campos");
      return;
    }
  
  var timestamp = data.unixtime;
        const app_code = appcode;
        const app_key = appkey;
        const key_time = app_key + timestamp;
        const uniq_token = CryptoJS.SHA256(key_time);
        const str_union = `${app_code};${timestamp};${uniq_token}`;
        const token = btoa(str_union);
  
    var myHeaders = new Headers();
    myHeaders.append("Content-Type", "application/json");
    myHeaders.append("auth-token", token);
  
    var raw = JSON.stringify({
    "carrier":{
      "id": "PSE",
      "extra_params": {
        "bank_code": paymentez_bankCode,
        "response_url": "https://paymentezapitest.netlify.app/getstatus",
        "user": {
          "name": name,
          "fiscal_number": fiscal,
          "type": paymentez_userType,
          "type_fis_number": paymentez_userFisNumber,
          "ip_address": data.client_ip
        }
      }
    },
    "user": {
      "id": "sdf",
      "email": email,
      "phone_number": "9878987677",
      "address":{
                  "street":"calle 1",
                  "number": "10",
                  "district": "district",
                  "city":"Cartagena",
                  "state":"Bolivar",
                  "zip":"130001"
      }
    },
    "order": {
      "country": "COL",
      "currency": "COP",
      "dev_reference": "1",
      "amount": amount,
      "vat": 0,
      "description": "description"
    }
  });
  
    var requestOptions = {
      method: 'POST',
      headers: myHeaders,
      body: raw,
      redirect: 'follow'
    };
  
    fetch(environment, requestOptions)
      .then(response => response.json())
      .then(result => {
        document.getElementById('result').style.display = 'block';
        document.getElementById('result').innerHTML = JSON.stringify(result, null, 2);
      })
      .catch(error => console.log('error', error));

      })
      .catch(error => {
        console.error('Error al obtener la hora: ', error);
      });

    }
</script>
<script src="index.js" type="text/javascript"></script>
</body>  
</html>

